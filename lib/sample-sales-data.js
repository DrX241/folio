/**
 * Dataset synthétique de ventes pour la démo Insight Generator
 * Données réalistes sur 6 mois avec produits, régions, clients
 */

export const salesData = [
  // Janvier 2025
  { id: 1, date: "2025-01-05", produit: "Produit A", region: "Paris", client: "Client Alpha", quantite: 15, prix_unitaire: 120, ca: 1800, categorie: "Premium" },
  { id: 2, date: "2025-01-08", produit: "Produit B", region: "Lyon", client: "Client Beta", quantite: 8, prix_unitaire: 85, ca: 680, categorie: "Standard" },
  { id: 3, date: "2025-01-12", produit: "Produit C", region: "Marseille", client: "Client Gamma", quantite: 20, prix_unitaire: 45, ca: 900, categorie: "Basique" },
  { id: 4, date: "2025-01-15", produit: "Produit A", region: "Paris", client: "Client Delta", quantite: 12, prix_unitaire: 120, ca: 1440, categorie: "Premium" },
  { id: 5, date: "2025-01-18", produit: "Produit B", region: "Lyon", client: "Client Alpha", quantite: 10, prix_unitaire: 85, ca: 850, categorie: "Standard" },
  { id: 6, date: "2025-01-22", produit: "Produit A", region: "Paris", client: "Client Epsilon", quantite: 25, prix_unitaire: 120, ca: 3000, categorie: "Premium" },
  { id: 7, date: "2025-01-25", produit: "Produit C", region: "Marseille", client: "Client Beta", quantite: 15, prix_unitaire: 45, ca: 675, categorie: "Basique" },
  
  // Février 2025
  { id: 8, date: "2025-02-03", produit: "Produit A", region: "Paris", client: "Client Alpha", quantite: 18, prix_unitaire: 120, ca: 2160, categorie: "Premium" },
  { id: 9, date: "2025-02-07", produit: "Produit B", region: "Lyon", client: "Client Gamma", quantite: 14, prix_unitaire: 85, ca: 1190, categorie: "Standard" },
  { id: 10, date: "2025-02-10", produit: "Produit C", region: "Marseille", client: "Client Delta", quantite: 30, prix_unitaire: 45, ca: 1350, categorie: "Basique" },
  { id: 11, date: "2025-02-14", produit: "Produit A", region: "Paris", client: "Client Beta", quantite: 22, prix_unitaire: 120, ca: 2640, categorie: "Premium" },
  { id: 12, date: "2025-02-18", produit: "Produit B", region: "Lyon", client: "Client Epsilon", quantite: 16, prix_unitaire: 85, ca: 1360, categorie: "Standard" },
  { id: 13, date: "2025-02-22", produit: "Produit C", region: "Marseille", client: "Client Alpha", quantite: 12, prix_unitaire: 45, ca: 540, categorie: "Basique" },
  { id: 14, date: "2025-02-26", produit: "Produit A", region: "Paris", client: "Client Gamma", quantite: 20, prix_unitaire: 120, ca: 2400, categorie: "Premium" },
  
  // Mars 2025
  { id: 15, date: "2025-03-05", produit: "Produit A", region: "Paris", client: "Client Delta", quantite: 28, prix_unitaire: 120, ca: 3360, categorie: "Premium" },
  { id: 16, date: "2025-03-09", produit: "Produit B", region: "Lyon", client: "Client Beta", quantite: 20, prix_unitaire: 85, ca: 1700, categorie: "Standard" },
  { id: 17, date: "2025-03-12", produit: "Produit C", region: "Marseille", client: "Client Epsilon", quantite: 35, prix_unitaire: 45, ca: 1575, categorie: "Basique" },
  { id: 18, date: "2025-03-16", produit: "Produit A", region: "Paris", client: "Client Alpha", quantite: 30, prix_unitaire: 120, ca: 3600, categorie: "Premium" },
  { id: 19, date: "2025-03-20", produit: "Produit B", region: "Lyon", client: "Client Gamma", quantite: 18, prix_unitaire: 85, ca: 1530, categorie: "Standard" },
  { id: 20, date: "2025-03-24", produit: "Produit C", region: "Marseille", client: "Client Delta", quantite: 25, prix_unitaire: 45, ca: 1125, categorie: "Basique" },
  { id: 21, date: "2025-03-28", produit: "Produit A", region: "Paris", client: "Client Beta", quantite: 24, prix_unitaire: 120, ca: 2880, categorie: "Premium" },
  
  // Avril 2025
  { id: 22, date: "2025-04-04", produit: "Produit A", region: "Paris", client: "Client Epsilon", quantite: 32, prix_unitaire: 120, ca: 3840, categorie: "Premium" },
  { id: 23, date: "2025-04-08", produit: "Produit B", region: "Lyon", client: "Client Alpha", quantite: 22, prix_unitaire: 85, ca: 1870, categorie: "Standard" },
  { id: 24, date: "2025-04-11", produit: "Produit C", region: "Marseille", client: "Client Gamma", quantite: 40, prix_unitaire: 45, ca: 1800, categorie: "Basique" },
  { id: 25, date: "2025-04-15", produit: "Produit A", region: "Paris", client: "Client Delta", quantite: 26, prix_unitaire: 120, ca: 3120, categorie: "Premium" },
  { id: 26, date: "2025-04-19", produit: "Produit B", region: "Lyon", client: "Client Beta", quantite: 25, prix_unitaire: 85, ca: 2125, categorie: "Standard" },
  { id: 27, date: "2025-04-23", produit: "Produit C", region: "Marseille", client: "Client Epsilon", quantite: 18, prix_unitaire: 45, ca: 810, categorie: "Basique" },
  { id: 28, date: "2025-04-27", produit: "Produit A", region: "Paris", client: "Client Alpha", quantite: 35, prix_unitaire: 120, ca: 4200, categorie: "Premium" },
  
  // Mai 2025
  { id: 29, date: "2025-05-03", produit: "Produit A", region: "Paris", client: "Client Gamma", quantite: 38, prix_unitaire: 120, ca: 4560, categorie: "Premium" },
  { id: 30, date: "2025-05-07", produit: "Produit B", region: "Lyon", client: "Client Delta", quantite: 28, prix_unitaire: 85, ca: 2380, categorie: "Standard" },
  { id: 31, date: "2025-05-10", produit: "Produit C", region: "Marseille", client: "Client Beta", quantite: 45, prix_unitaire: 45, ca: 2025, categorie: "Basique" },
  { id: 32, date: "2025-05-14", produit: "Produit A", region: "Paris", client: "Client Epsilon", quantite: 30, prix_unitaire: 120, ca: 3600, categorie: "Premium" },
  { id: 33, date: "2025-05-18", produit: "Produit B", region: "Lyon", client: "Client Alpha", quantite: 30, prix_unitaire: 85, ca: 2550, categorie: "Standard" },
  { id: 34, date: "2025-05-22", produit: "Produit C", region: "Marseille", client: "Client Gamma", quantite: 22, prix_unitaire: 45, ca: 990, categorie: "Basique" },
  { id: 35, date: "2025-05-26", produit: "Produit A", region: "Paris", client: "Client Delta", quantite: 40, prix_unitaire: 120, ca: 4800, categorie: "Premium" },
  
  // Juin 2025
  { id: 36, date: "2025-06-02", produit: "Produit A", region: "Paris", client: "Client Beta", quantite: 42, prix_unitaire: 120, ca: 5040, categorie: "Premium" },
  { id: 37, date: "2025-06-06", produit: "Produit B", region: "Lyon", client: "Client Epsilon", quantite: 32, prix_unitaire: 85, ca: 2720, categorie: "Standard" },
  { id: 38, date: "2025-06-10", produit: "Produit C", region: "Marseille", client: "Client Alpha", quantite: 50, prix_unitaire: 45, ca: 2250, categorie: "Basique" },
  { id: 39, date: "2025-06-14", produit: "Produit A", region: "Paris", client: "Client Gamma", quantite: 36, prix_unitaire: 120, ca: 4320, categorie: "Premium" },
  { id: 40, date: "2025-06-18", produit: "Produit B", region: "Lyon", client: "Client Delta", quantite: 35, prix_unitaire: 85, ca: 2975, categorie: "Standard" },
  { id: 41, date: "2025-06-22", produit: "Produit C", region: "Marseille", client: "Client Beta", quantite: 28, prix_unitaire: 45, ca: 1260, categorie: "Basique" },
  { id: 42, date: "2025-06-26", produit: "Produit A", region: "Paris", client: "Client Epsilon", quantite: 45, prix_unitaire: 120, ca: 5400, categorie: "Premium" }
];

/**
 * Calcule les statistiques de base pour une vue donnée
 */
export function calculateStats(data, view) {
  if (!data || data.length === 0) {
    return null;
  }

  const stats = {
    totalCA: 0,
    totalQuantite: 0,
    nombreVentes: data.length,
    moyenneCA: 0,
    topItems: []
  };

  // Calculs de base
  data.forEach(item => {
    stats.totalCA += item.ca;
    stats.totalQuantite += item.quantite;
  });

  stats.moyenneCA = stats.totalCA / stats.nombreVentes;

  // Top items selon la vue
  if (view === "produit") {
    const byProduit = {};
    data.forEach(item => {
      if (!byProduit[item.produit]) {
        byProduit[item.produit] = { nom: item.produit, ca: 0, quantite: 0, count: 0 };
      }
      byProduit[item.produit].ca += item.ca;
      byProduit[item.produit].quantite += item.quantite;
      byProduit[item.produit].count += 1;
    });
    stats.topItems = Object.values(byProduit)
      .sort((a, b) => b.ca - a.ca)
      .slice(0, 3);
  } else if (view === "region") {
    const byRegion = {};
    data.forEach(item => {
      if (!byRegion[item.region]) {
        byRegion[item.region] = { nom: item.region, ca: 0, quantite: 0, count: 0 };
      }
      byRegion[item.region].ca += item.ca;
      byRegion[item.region].quantite += item.quantite;
      byRegion[item.region].count += 1;
    });
    stats.topItems = Object.values(byRegion)
      .sort((a, b) => b.ca - a.ca)
      .slice(0, 3);
  } else if (view === "mois") {
    const byMois = {};
    data.forEach(item => {
      const d = new Date(item.date);
      const year = d.getFullYear();
      const monthIndex = d.getMonth(); // 0-11
      const key = `${year}-${String(monthIndex + 1).padStart(2, "0")}`; // ex: 2025-01
      const label = d.toLocaleDateString("fr-FR", {
        month: "long",
        year: "numeric"
      });

      if (!byMois[key]) {
        byMois[key] = { nom: label, key, ca: 0, quantite: 0, count: 0 };
      }
      byMois[key].ca += item.ca;
      byMois[key].quantite += item.quantite;
      byMois[key].count += 1;
    });
    stats.topItems = Object.values(byMois).sort((a, b) =>
      a.key.localeCompare(b.key)
    );
  }

  return stats;
}


